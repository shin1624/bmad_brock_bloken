# Story 8.3: Level Editor Tutorial Implementation

## Status
Draft

## Story
**As a** player,  
**I want** an interactive tutorial that teaches me how to use the level editor,  
**So that** I can easily create custom levels without confusion.

## Acceptance Criteria
1. [ ] Tutorial automatically starts on first level editor access
2. [ ] Step-by-step guide walks through all editor features
3. [ ] Interactive tooltips highlight relevant UI elements
4. [ ] Each step requires user action to proceed (hands-on learning)
5. [ ] Sample level templates are provided for quick start
6. [ ] Tutorial can be skipped with "Skip Tutorial" button
7. [ ] Tutorial can be replayed from help menu
8. [ ] Progress is saved and can be resumed
9. [ ] Tutorial covers: placing blocks, removing blocks, testing level, saving level
10. [ ] Completion gives user a "Tutorial Complete" achievement/badge

## Tasks / Subtasks
- [ ] **Task 1: Create Tutorial Component Structure** (AC: 1, 2)
  - [ ] Create `src/components/editor/Tutorial/Tutorial.tsx`
  - [ ] Create `src/components/editor/Tutorial/Tutorial.css`
  - [ ] Implement TutorialStep interface
  - [ ] Create tutorial state management (Zustand store)
  - [ ] Add first-time detection logic

- [ ] **Task 2: Implement Step Management System** (AC: 2, 4, 8)
  - [ ] Create step progression logic
  - [ ] Implement step validation (user completed required action)
  - [ ] Add next/previous navigation
  - [ ] Save progress to localStorage
  - [ ] Implement resume functionality

- [ ] **Task 3: Create Interactive Tooltips** (AC: 3, 4)
  - [ ] Create `Tooltip.tsx` component
  - [ ] Implement spotlight/highlight effect
  - [ ] Add pointer arrows to UI elements
  - [ ] Create animated entrance/exit effects
  - [ ] Ensure tooltips don't block interaction

- [ ] **Task 4: Define Tutorial Content** (AC: 9)
  - [ ] Step 1: Welcome and overview
  - [ ] Step 2: Selecting block types
  - [ ] Step 3: Placing blocks on grid
  - [ ] Step 4: Removing blocks
  - [ ] Step 5: Using special blocks
  - [ ] Step 6: Testing your level
  - [ ] Step 7: Saving your level
  - [ ] Step 8: Loading and editing saved levels

- [ ] **Task 5: Add Sample Templates** (AC: 5)
  - [ ] Create 3-5 template levels
  - [ ] Add template selector in tutorial
  - [ ] Implement "Start from Template" option
  - [ ] Create template preview component
  - [ ] Store templates in `src/assets/levels/templates/`

- [ ] **Task 6: Implement Skip and Replay** (AC: 6, 7)
  - [ ] Add skip button with confirmation dialog
  - [ ] Add tutorial option to help menu
  - [ ] Create "Reset Tutorial" option
  - [ ] Track tutorial completion status
  - [ ] Show different UI for completed vs new users

- [ ] **Task 7: Add Tutorial Completion Reward** (AC: 10)
  - [ ] Create achievement system if not exists
  - [ ] Design "Editor Pro" badge/achievement
  - [ ] Display completion celebration
  - [ ] Save achievement to user profile
  - [ ] Add achievement to user stats

- [ ] **Task 8: Add Tests** (AC: all)
  - [ ] Unit tests for Tutorial component
  - [ ] Unit tests for step progression
  - [ ] E2E test for complete tutorial flow
  - [ ] E2E test for skip functionality
  - [ ] Test localStorage persistence

## Dev Notes
### Relevant Source Files
- **Level Editor Component**: `src/components/editor/LevelEditor.tsx`
- **Editor UI Pattern**: Reference existing editor implementation
- **State Management**: Use Zustand store pattern from `src/stores/`
- **LocalStorage Service**: `src/services/storage/StorageService.ts`

### Tutorial Flow Architecture
```typescript
interface TutorialStep {
  id: string;
  title: string;
  description: string;
  targetElement?: string; // CSS selector
  requiredAction?: 'click' | 'drag' | 'place' | 'remove';
  validationFn?: () => boolean;
  tooltipPosition?: 'top' | 'bottom' | 'left' | 'right';
}

interface TutorialState {
  isActive: boolean;
  currentStep: number;
  completed: boolean;
  skipped: boolean;
  steps: TutorialStep[];
  // Actions
  nextStep: () => void;
  previousStep: () => void;
  skipTutorial: () => void;
  restartTutorial: () => void;
}
```

### Component Structure
```
src/
  components/
    editor/
      Tutorial/
        Tutorial.tsx          // Main component
        Tutorial.css         // Styles
        TutorialStep.tsx     // Single step component
        TutorialTooltip.tsx  // Tooltip component
        TutorialOverlay.tsx  // Spotlight overlay
        __tests__/
          Tutorial.test.tsx
        index.ts            // Barrel export
  stores/
    tutorialStore.ts       // Zustand store
  assets/
    levels/
      templates/
        template-basic.json
        template-pyramid.json
        template-spiral.json
```

### Sample Tutorial Steps
```typescript
const tutorialSteps: TutorialStep[] = [
  {
    id: 'welcome',
    title: 'Welcome to the Level Editor!',
    description: 'Let\'s learn how to create amazing levels.',
    requiredAction: 'click',
  },
  {
    id: 'select-block',
    title: 'Select a Block Type',
    description: 'Click on a block type from the palette.',
    targetElement: '.block-palette',
    requiredAction: 'click',
    tooltipPosition: 'right',
  },
  {
    id: 'place-block',
    title: 'Place Your First Block',
    description: 'Click on the grid to place the block.',
    targetElement: '.editor-grid',
    requiredAction: 'place',
    validationFn: () => checkBlockPlaced(),
    tooltipPosition: 'top',
  },
  // ... more steps
];
```

### Implementation Guidelines
1. Use React Portal for overlay elements
2. Ensure tutorial doesn't interfere with editor functionality
3. Make tutorial responsive for different screen sizes
4. Use smooth animations (CSS transitions)
5. Implement keyboard shortcuts (ESC to skip, Enter to continue)
6. Consider accessibility (screen readers, keyboard navigation)
7. Use local storage key: `blockbreaker_tutorial_state`

### Testing Standards
From architecture requirements:
- **Unit Tests**: Cover all tutorial logic and state management
- **E2E Tests**: Full tutorial walkthrough scenarios
- **Coverage**: Maintain 90%+ coverage
- **Accessibility**: Test with screen readers

### Tutorial Content Guidelines
- Keep instructions concise and clear
- Use action verbs ("Click", "Drag", "Place")
- Provide visual cues (animations, highlights)
- Give immediate feedback for actions
- Allow users to experiment between steps
- Include congratulations message at completion

## Testing
### Unit Test Requirements
- Tutorial component renders correctly
- Step progression works
- Skip functionality works
- LocalStorage persistence
- Tooltip positioning
- Achievement unlock

### E2E Test Scenarios
```typescript
// e2e/tests/level-editor-tutorial.spec.ts
test('should complete tutorial flow', async ({ page }) => {
  await page.goto('/editor');
  // First time user sees tutorial
  await expect(page.getByText('Welcome to the Level Editor')).toBeVisible();
  // Complete each step
  // Verify completion
});

test('should skip tutorial', async ({ page }) => {
  await page.goto('/editor');
  await page.getByRole('button', { name: /skip tutorial/i }).click();
  await page.getByRole('button', { name: /confirm/i }).click();
  // Verify editor is accessible
});
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-28 | v1.0 | Initial story creation | Scrum Master Bob |

---

## Dev Agent Record
### Agent Model Used
*To be filled by development agent*

### Debug Log References
*To be filled during development*

### Completion Notes List
*To be filled during development*

### File List
*To be filled during development - expected files:*
- [ ] `src/components/editor/Tutorial/Tutorial.tsx` (new)
- [ ] `src/components/editor/Tutorial/Tutorial.css` (new)
- [ ] `src/components/editor/Tutorial/TutorialStep.tsx` (new)
- [ ] `src/components/editor/Tutorial/TutorialTooltip.tsx` (new)
- [ ] `src/components/editor/Tutorial/TutorialOverlay.tsx` (new)
- [ ] `src/components/editor/Tutorial/__tests__/Tutorial.test.tsx` (new)
- [ ] `src/components/editor/Tutorial/index.ts` (new)
- [ ] `src/stores/tutorialStore.ts` (new)
- [ ] `src/assets/levels/templates/template-basic.json` (new)
- [ ] `src/assets/levels/templates/template-pyramid.json` (new)
- [ ] `src/assets/levels/templates/template-spiral.json` (new)
- [ ] `src/components/editor/LevelEditor.tsx` (modified)
- [ ] `e2e/tests/level-editor-tutorial.spec.ts` (new)

## QA Results
*To be filled by QA agent*