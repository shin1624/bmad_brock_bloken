# 4. エピックとユーザーストーリー

## Epic 1: ゲーム基盤構築 - Phase 1実装詳細
**目的**: Reactアプリケーションの土台とCanvasゲームエンジンの統合を段階的に実装し、60 FPSでの安定動作とReact-Canvas状態同期を実現する

**既存システムコンテキスト:**
- 現在の関連機能: React 19 + TypeScript 5 + Vite + Zustand セットアップ完了
- 技術スタック: React, TypeScript, Vite, Tailwind CSS, Zustand
- 統合ポイント: React コンポーネント階層、既存store構造、TypeScript型システム

**Phase 1実装詳細:**
- 追加/変更内容: Canvas ベースのゲームエンジンとReact統合
- 統合方法: GameCanvas Reactコンポーネント、カスタムフックによる状態ブリッジ
- 成功基準: 60 FPS レンダリング、React-Canvas 状態同期、デバッグパフォーマンス監視

### Story 1.1: プロジェクトセットアップ
**As a** 開発者  
**I want** React + TypeScript + Viteの開発環境  
**So that** 効率的に開発を進められる

**受け入れ基準:**
- Viteプロジェクトが正常に作成される
- React 18とTypeScript 5が設定される
- ESLintとPrettierが設定される
- 基本的なフォルダ構造が作成される
- HMRが正常に動作する

### Story 1.2: Canvasゲームエンジン基盤（段階的実装）
**As a** 開発者  
**I want** requestAnimationFrameベースのゲームループとReact統合システム  
**So that** 60FPSでの安定したゲーム描画とパフォーマンス監視ができる

**受け入れ基準（Phase 1-A: ゲームループ）:**
- requestAnimationFrameベースのゲームループ実装
- 60 FPS での安定動作とパフォーマンスモニタリング
- useGameLoopカスタムフックによるReact統合
- FPSカウンターとデバッグ情報表示
- 既存Reactアプリケーション機能の保持

**受け入れ基準（Phase 1-B: Canvas統合）:**
- Canvas要素のReactコンポーネント化
- 基本的な描画メソッド実装
- React-Canvas状態同期システム
- GameCanvasコンポーネントの作成
- 描画パイプラインの基礎実装

**技術仕様:**
- 実装ファイル: `src/hooks/useGameLoop.ts`, `src/game/core/GameLoop.ts`, `src/components/game/GameCanvas.tsx`
- テストカバレッジ: >90% (ゲームループロジック)
- パフォーマンス目標: 60 FPS維持率 >95%

### Story 1.3: 状態管理システム
**As a** 開発者  
**I want** UIとゲーム状態の分離管理  
**So that** 複雑な状態を効率的に扱える

**受け入れ基準:**
- Zustandによる UI状態管理
- カスタムGameStateクラス
- ReactとCanvasの状態同期
- 状態変更のイベントシステム
- DevToolsでの状態確認

## Epic 2: コアゲームプレイ
**目的**: 基本的なブロック崩しゲームメカニクスの実装

### Story 2.1: パドルコントロール
**As a** プレイヤー  
**I want** パドルを操作できる  
**So that** ボールを打ち返せる

**受け入れ基準:**
- キーボード（矢印キー/WASD）対応
- マウス追従モード
- タッチスクリーン対応
- スムーズな移動（補間処理）
- 画面端での移動制限

### Story 2.2: ボール物理演算
**As a** プレイヤー  
**I want** リアルなボールの動き  
**So that** 予測可能で楽しいゲームプレイができる

**受け入れ基準:**
- 速度と方向の管理
- 壁との反射
- パドルとの角度付き反射
- 重力オプション（上級モード）
- 速度上限/下限の設定

### Story 2.3: ブロックシステム
**As a** プレイヤー  
**I want** 様々なブロックを破壊できる  
**So that** 達成感を得られる

**受け入れ基準:**
- グリッドベースのブロック配置
- 複数のブロックタイプ（通常、硬い、破壊不可）
- ヒットポイントシステム
- 破壊エフェクト（パーティクル）
- スコア計算

### Story 2.4: 衝突検出システム
**As a** プレイヤー  
**I want** 正確な衝突判定  
**So that** 公平なゲームプレイができる

**受け入れ基準:**
- AABB衝突検出
- ボール-パドル衝突
- ボール-ブロック衝突
- 複数同時衝突の処理
- 貫通バグの防止

## Epic 3: UI/UXシステム
**目的**: Reactベースの洗練されたユーザーインターフェース

### Story 3.1: メインメニュー
**As a** プレイヤー  
**I want** 直感的なメインメニュー  
**So that** ゲームを簡単に開始できる

**受け入れ基準:**
- スタートボタン
- 設定へのアクセス
- ハイスコア表示
- レベル選択
- アニメーション効果

### Story 3.2: ゲームHUD
**As a** プレイヤー  
**I want** ゲーム情報を確認できる  
**So that** 状況を把握できる

**受け入れ基準:**
- 現在スコア表示
- 残機数表示
- レベル表示
- パワーアップ状態
- コンボカウンター

### Story 3.3: 一時停止システム
**As a** プレイヤー  
**I want** ゲームを一時停止できる  
**So that** 休憩できる

**受け入れ基準:**
- ESCキーで一時停止
- 一時停止メニュー表示
- 再開オプション
- メインメニューへ戻る
- 設定へのアクセス

## Epic 4: パワーアップシステム
**目的**: ゲームプレイに深みを加える特殊能力

### Story 4.1: パワーアップ基盤
**As a** 開発者  
**I want** 拡張可能なパワーアップシステム  
**So that** 新しいパワーアップを簡単に追加できる

**受け入れ基準:**
- パワーアップ基底クラス
- プラグイン形式での追加
- 効果の重ね掛け管理
- 持続時間管理
- ビジュアルインジケーター

### Story 4.2: 基本パワーアップ実装
**As a** プレイヤー  
**I want** 様々なパワーアップ  
**So that** 戦略的なプレイができる

**受け入れ基準（MVP）:**
- マルチボール（3個同時）
- パドルサイズ変更（大/小）
- ボール速度変更（速/遅）

**将来的な追加（v2.0）:**
- 貫通ボール
- マグネットパドル

## Epic 5: ビジュアルとオーディオ
**目的**: モダンレトロな視覚効果と音響効果

### Story 5.1: テーマシステム
**As a** プレイヤー  
**I want** 複数のビジュアルテーマ  
**So that** 好みの見た目でプレイできる

**受け入れ基準:**
- ネオンテーマ
- ピクセルテーマ
- シンセウェーブテーマ
- ミニマルテーマ
- リアルタイム切り替え

### Story 5.2: パーティクルエフェクト
**As a** プレイヤー  
**I want** 満足感のある視覚効果  
**So that** アクションが楽しく感じる

**受け入れ基準:**
- ブロック破壊パーティクル
- トレイルエフェクト
- 衝突スパーク
- パワーアップ獲得エフェクト
- 背景アニメーション

### Story 5.3: サウンドシステム
**As a** プレイヤー  
**I want** 効果音とBGM  
**So that** 没入感が高まる

**受け入れ基準:**
- Web Audio API使用
- 衝突音
- ブロック破壊音
- BGMループ
- 音量調整機能

## Epic 6: レベルエディター
**目的**: ユーザー生成コンテンツのサポート

### Story 6.1: エディターUI
**As a** プレイヤー  
**I want** 直感的なレベルエディター  
**So that** オリジナルレベルを作成できる

**受け入れ基準:**
- ドラッグ&ドロップインターフェース
- ブロックパレット
- グリッドスナップ
- プレビュー機能
- 元に戻す/やり直し

### Story 6.2: レベル保存/共有
**As a** プレイヤー  
**I want** 作成したレベルを保存・共有できる  
**So that** 他のプレイヤーと楽しめる

**受け入れ基準:**
- JSON形式でのエクスポート
- レベルコードの生成
- インポート機能
- ローカルストレージ保存
- 検証機能

## Epic 7: 品質保証とテスト
**目的**: 高品質で信頼性の高いゲーム

### Story 7.1: ユニットテスト
**As a** 開発者  
**I want** 包括的なユニットテスト  
**So that** バグを早期発見できる

**受け入れ基準:**
- Vitestセットアップ
- ゲームロジックのテスト
- 物理演算のテスト
- 状態管理のテスト
- 90%以上のカバレッジ

### Story 7.2: E2Eテスト
**As a** 開発者  
**I want** エンドツーエンドテスト  
**So that** ユーザー体験を検証できる

**受け入れ基準:**
- Playwrightセットアップ
- 主要ユーザーフローのテスト
- クロスブラウザテスト
- レスポンシブテスト
- パフォーマンステスト
