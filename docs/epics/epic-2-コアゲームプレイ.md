# Epic 2: コアゲームプレイ

**目的**: 基本的なブロック崩しゲームメカニクスの実装

**前提条件**: 
- Epic 1（ゲーム基盤構築）が完了
- Canvas ゲームエンジンが動作中
- 状態管理システムが実装済み
- 60 FPSでの安定動作確認済み

## Story 2.1: パドルコントロール
**As a** プレイヤー  
**I want** パドルを操作できる  
**So that** ボールを打ち返せる

**受け入れ基準:**
1. キーボード操作（矢印キー左右/A・Dキー）対応
2. マウス追従モード（マウスX座標にパドルが追従）
3. タッチスクリーン対応（タッチX座標にパドルが追従）
4. スムーズな移動（線形補間処理による滑らかな動き）
5. 画面端での移動制限（パドルが画面外に出ない）

**技術仕様:**
- パドル速度: 8px/frame（キーボード）、即座（マウス/タッチ）
- パドルサイズ: 幅100px、高さ20px（デフォルト）
- 移動範囲: X軸 0 ~ (canvas.width - paddle.width)
- 入力システム: InputManagerクラスで統一管理

## Story 2.2: ボール物理演算
**As a** プレイヤー  
**I want** リアルなボールの動き  
**So that** 予測可能で楽しいゲームプレイができる

**受け入れ基準:**
1. 速度ベクトル（vx, vy）による移動
2. 壁（上、左、右）との反射計算
3. パドルとの角度付き反射（打つ位置で反射角変化）
4. 重力オプション（上級モード用、デフォルトOFF）
5. 速度上限/下限の設定（最小3px/frame、最大15px/frame）

**技術仕様:**
- ボール半径: 8px
- 初期速度: 5px/frame、角度-45度
- 反射計算: 入射角=反射角（壁）、位置依存（パドル）
- 速度増加: ブロック破壊ごとに2%増加（最大速度まで）

## Story 2.3: ブロックシステム
**As a** プレイヤー  
**I want** 様々なブロックを破壊できる  
**So that** 達成感を得られる

**受け入れ基準:**
1. グリッドベースのブロック配置（10列×8行）
2. 複数のブロックタイプ:
   - 通常ブロック（1ヒットで破壊、100点）
   - 硬いブロック（2ヒットで破壊、200点）
   - 破壊不可ブロック（破壊不可、0点）
3. ヒットポイントシステム（視覚的フィードバック）
4. 破壊エフェクト（パーティクル生成）
5. スコア計算とコンボシステム

**技術仕様:**
- ブロックサイズ: 75px × 25px
- グリッド間隔: 5px
- 破壊判定: AABB衝突検出
- パーティクル: 破壊時に8個生成、0.5秒で消滅

## Story 2.4: 衝突検出システム
**As a** プレイヤー  
**I want** 正確な衝突判定  
**So that** 公平なゲームプレイができる

**受け入れ基準:**
1. AABB（Axis-Aligned Bounding Box）衝突検出実装
2. ボール-パドル衝突（反射角計算含む）
3. ボール-ブロック衝突（ブロック破壊処理含む）
4. 複数同時衝突の優先順位処理
5. 貫通バグの防止（フレーム間移動距離考慮）

**技術仕様:**
- 衝突検出: 毎フレーム実行（60Hz）
- 優先順位: パドル > ブロック > 壁
- 貫通防止: 連続衝突検出（CCD）アルゴリズム
- デバッグモード: 衝突ボックス可視化（F6キー）

## リスクと依存関係

**技術的リスク:**
- 高速移動時の衝突検出精度
- 複数入力デバイスの同時処理
- モバイルデバイスでのパフォーマンス

**依存関係:**
- GameStateManager（Story 1.3）
- GameLoop（Story 1.2）
- Canvas レンダリングシステム（Story 1.2）

## 成功指標
- すべてのストーリーが「Done」ステータス
- 統合テストで衝突検出精度99%以上
- 60 FPS維持率95%以上
- モバイルデバイスで30 FPS以上