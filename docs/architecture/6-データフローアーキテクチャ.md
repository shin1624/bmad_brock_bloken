# 6. データフローアーキテクチャ

## 6.1 単方向データフロー
```
User Input → Event Handler → State Update → Re-render
     ↑                                           ↓
     └────────── Visual Feedback ←──────────────┘
```

## 6.2 状態管理戦略
```typescript
// UI状態 (Zustand)
interface UIState {
  currentScreen: Screen;
  isPaused: boolean;
  selectedTheme: string;
  volume: number;
  
  setScreen: (screen: Screen) => void;
  togglePause: () => void;
  setTheme: (theme: string) => void;
  setVolume: (volume: number) => void;
}

// ゲーム状態 (カスタム)
class GameStateManager {
  private state: GameState = {
    score: 0,
    level: 1,
    lives: 3,
    balls: [],
    blocks: [],
    powerUps: [],
    gameStatus: 'idle'
  };
  
  private subscribers: Set<StateSubscriber> = new Set();
  
  updateState(updater: (state: GameState) => GameState): void {
    this.state = updater(this.state);
    this.notifySubscribers();
  }
  
  subscribe(subscriber: StateSubscriber): void {
    this.subscribers.add(subscriber);
  }
  
  private notifySubscribers(): void {
    this.subscribers.forEach(sub => sub(this.state));
  }
}
```
