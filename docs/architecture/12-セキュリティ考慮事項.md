# 12. セキュリティ考慮事項

## 12.1 入力検証
```typescript
class InputValidator {
  static validateLevelData(data: unknown): LevelData {
    // スキーマ検証
    if (!this.isValidLevelSchema(data)) {
      throw new Error('Invalid level data');
    }
    
    // サニタイゼーション
    return this.sanitizeLevelData(data as LevelData);
  }
  
  private static sanitizeLevelData(data: LevelData): LevelData {
    return {
      ...data,
      name: this.sanitizeString(data.name),
      blocks: data.blocks.map(block => ({
        ...block,
        type: this.validateBlockType(block.type)
      }))
    };
  }
}
```

## 12.2 XSS対策
```typescript
// ユーザー入力のエスケープ
function escapeHtml(unsafe: string): string {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// Content Security Policy
const CSP_HEADER = {
  'Content-Security-Policy': 
    "default-src 'self'; " +
    "script-src 'self' 'unsafe-inline'; " +
    "style-src 'self' 'unsafe-inline'; " +
    "img-src 'self' data:; " +
    "media-src 'self';"
};
```
