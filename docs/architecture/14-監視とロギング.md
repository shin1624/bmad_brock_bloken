# 14. 監視とロギング

## 14.1 パフォーマンス監視
```typescript
class PerformanceMonitor {
  private metrics: Map<string, number[]> = new Map();
  
  startMeasure(label: string): void {
    performance.mark(`${label}-start`);
  }
  
  endMeasure(label: string): void {
    performance.mark(`${label}-end`);
    performance.measure(label, `${label}-start`, `${label}-end`);
    
    const measure = performance.getEntriesByName(label)[0];
    this.recordMetric(label, measure.duration);
  }
  
  private recordMetric(label: string, value: number): void {
    if (!this.metrics.has(label)) {
      this.metrics.set(label, []);
    }
    this.metrics.get(label)!.push(value);
    
    // 統計情報の計算
    if (this.metrics.get(label)!.length % 100 === 0) {
      this.reportStatistics(label);
    }
  }
  
  private reportStatistics(label: string): void {
    const values = this.metrics.get(label)!;
    const avg = values.reduce((a, b) => a + b) / values.length;
    const max = Math.max(...values);
    const min = Math.min(...values);
    
    console.log(`[Performance] ${label}: avg=${avg.toFixed(2)}ms, min=${min.toFixed(2)}ms, max=${max.toFixed(2)}ms`);
  }
}
```

## 14.2 エラートラッキング
```typescript
class ErrorTracker {
  static logError(error: Error, context?: any): void {
    console.error('[Error]', error.message, {
      stack: error.stack,
      context,
      timestamp: new Date().toISOString(),
      userAgent: navigator.userAgent
    });
    
    // 本番環境では外部サービスに送信
    if (config.analytics) {
      // Sentryなどに送信
      this.sendToAnalytics(error, context);
    }
  }
  
  private static sendToAnalytics(error: Error, context?: any): void {
    // 実装
  }
}
```
