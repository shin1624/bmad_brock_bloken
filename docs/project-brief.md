# ブロック崩しゲーム PRD（製品要求仕様書）

## 1. エグゼクティブサマリー

### 1.1 プロジェクト概要
モダンレトロなデザインと高い拡張性を持つブラウザベースのブロック崩しゲームを開発する。React（UIレイヤー）とCanvas API（ゲームレンダリング）のハイブリッドアーキテクチャを採用し、優れたユーザー体験とパフォーマンスを実現する。

### 1.2 主要成果物
- プレイ可能なブロック崩しゲーム（Web版）
- プラグイン対応の拡張可能なアーキテクチャ
- レベルエディター
- 複数のビジュアルテーマ
- 包括的なドキュメントとテストスイート

### 1.3 成功基準
- 60 FPS での安定動作
- 5分以上の平均プレイ時間
- 90%以上のテストカバレッジ
- 2時間以内での新機能追加が可能な拡張性

## 2. 機能要件（FR）

### FR1: ゲームコア機能
- **FR1.1**: ボールとパドルの物理演算
- **FR1.2**: ブロックの配置と破壊システム
- **FR1.3**: スコア計算とレベル進行
- **FR1.4**: ゲーム状態管理（開始、プレイ中、一時停止、ゲームオーバー）
- **FR1.5**: 衝突検出と応答システム

### FR2: ユーザーインターフェース
- **FR2.1**: Reactベースのメインメニュー
- **FR2.2**: ゲーム設定画面（音量、難易度、コントロール）
- **FR2.3**: ハイスコア表示とリーダーボード
- **FR2.4**: 一時停止メニューとゲームオーバー画面
- **FR2.5**: テーマセレクター

### FR3: ゲームプレイ機能
- **FR3.1**: パワーアップシステム（最低5種類）
- **FR3.2**: 複数のブロックタイプ（通常、硬い、特殊）
- **FR3.3**: コンボシステムと連鎖ボーナス
- **FR3.4**: レベルデザイン（最低10レベル）
- **FR3.5**: ボスブロック（特定レベル）

### FR4: カスタマイズ機能
- **FR4.1**: レベルエディター（ドラッグ&ドロップ）
- **FR4.2**: カスタムレベルの保存と共有
- **FR4.3**: ビジュアルテーマの切り替え
- **FR4.4**: ボール/パドルスキンのカスタマイズ

### FR5: データ管理
- **FR5.1**: ローカルストレージでのハイスコア保存
- **FR5.2**: ゲーム設定の永続化
- **FR5.3**: カスタムレベルの保存/読み込み
- **FR5.4**: プレイ統計の記録

## 3. 非機能要件（NFR）

### NFR1: パフォーマンス
- **NFR1.1**: 60 FPS を95%以上の時間で維持
- **NFR1.2**: 入力遅延 16ms 以下
- **NFR1.3**: 初期ロード時間 3秒以下
- **NFR1.4**: メモリ使用量 200MB 以下

### NFR2: 使いやすさ
- **NFR2.1**: 説明なしで基本操作が理解できる
- **NFR2.2**: キーボードとマウス/タッチの両対応
- **NFR2.3**: レスポンシブデザイン（320px〜4K対応）
- **NFR2.4**: アクセシビリティ（WCAG 2.1 AA準拠）

### NFR3: 信頼性
- **NFR3.1**: ブラウザクラッシュなし
- **NFR3.2**: データ損失防止（自動セーブ）
- **NFR3.3**: エラーからの優雅な回復
- **NFR3.4**: 99%以上の稼働率

### NFR4: 保守性
- **NFR4.1**: TypeScriptによる型安全性
- **NFR4.2**: 90%以上のテストカバレッジ
- **NFR4.3**: ESLint/Prettierによるコード品質
- **NFR4.4**: 包括的なドキュメント

### NFR5: 拡張性
- **NFR5.1**: プラグインアーキテクチャ
- **NFR5.2**: イベント駆動システム
- **NFR5.3**: 疎結合なコンポーネント設計
- **NFR5.4**: 明確なAPIインターフェース

## 4. エピックとユーザーストーリー

### Epic 1: ゲーム基盤構築
**目的**: Reactアプリケーションの土台とCanvasゲームエンジンの統合

#### Story 1.1: プロジェクトセットアップ
**As a** 開発者  
**I want** React + TypeScript + Viteの開発環境  
**So that** 効率的に開発を進められる

**受け入れ基準:**
- Viteプロジェクトが正常に作成される
- React 18とTypeScript 5が設定される
- ESLintとPrettierが設定される
- 基本的なフォルダ構造が作成される
- HMRが正常に動作する

#### Story 1.2: Canvasゲームエンジン基盤
**As a** 開発者  
**I want** ゲームループとレンダリングシステム  
**So that** ゲーム描画を制御できる

**受け入れ基準:**
- requestAnimationFrameベースのゲームループ
- 60 FPSでの安定動作
- Canvas要素のReactコンポーネント化
- 基本的な描画メソッド実装
- デバッグ用FPSカウンター表示

#### Story 1.3: 状態管理システム
**As a** 開発者  
**I want** UIとゲーム状態の分離管理  
**So that** 複雑な状態を効率的に扱える

**受け入れ基準:**
- Zustandによる UI状態管理
- カスタムGameStateクラス
- ReactとCanvasの状態同期
- 状態変更のイベントシステム
- DevToolsでの状態確認

### Epic 2: コアゲームプレイ
**目的**: 基本的なブロック崩しゲームメカニクスの実装

#### Story 2.1: パドルコントロール
**As a** プレイヤー  
**I want** パドルを操作できる  
**So that** ボールを打ち返せる

**受け入れ基準:**
- キーボード（矢印キー/WASD）対応
- マウス追従モード
- タッチスクリーン対応
- スムーズな移動（補間処理）
- 画面端での移動制限

#### Story 2.2: ボール物理演算
**As a** プレイヤー  
**I want** リアルなボールの動き  
**So that** 予測可能で楽しいゲームプレイができる

**受け入れ基準:**
- 速度と方向の管理
- 壁との反射
- パドルとの角度付き反射
- 重力オプション（上級モード）
- 速度上限/下限の設定

#### Story 2.3: ブロックシステム
**As a** プレイヤー  
**I want** 様々なブロックを破壊できる  
**So that** 達成感を得られる

**受け入れ基準:**
- グリッドベースのブロック配置
- 複数のブロックタイプ（通常、硬い、破壊不可）
- ヒットポイントシステム
- 破壊エフェクト（パーティクル）
- スコア計算

#### Story 2.4: 衝突検出システム
**As a** プレイヤー  
**I want** 正確な衝突判定  
**So that** 公平なゲームプレイができる

**受け入れ基準:**
- AABB衝突検出
- ボール-パドル衝突
- ボール-ブロック衝突
- 複数同時衝突の処理
- 貫通バグの防止

### Epic 3: UI/UXシステム
**目的**: Reactベースの洗練されたユーザーインターフェース

#### Story 3.1: メインメニュー
**As a** プレイヤー  
**I want** 直感的なメインメニュー  
**So that** ゲームを簡単に開始できる

**受け入れ基準:**
- スタートボタン
- 設定へのアクセス
- ハイスコア表示
- レベル選択
- アニメーション効果

#### Story 3.2: ゲームHUD
**As a** プレイヤー  
**I want** ゲーム情報を確認できる  
**So that** 状況を把握できる

**受け入れ基準:**
- 現在スコア表示
- 残機数表示
- レベル表示
- パワーアップ状態
- コンボカウンター

#### Story 3.3: 一時停止システム
**As a** プレイヤー  
**I want** ゲームを一時停止できる  
**So that** 休憩できる

**受け入れ基準:**
- ESCキーで一時停止
- 一時停止メニュー表示
- 再開オプション
- メインメニューへ戻る
- 設定へのアクセス

### Epic 4: パワーアップシステム
**目的**: ゲームプレイに深みを加える特殊能力

#### Story 4.1: パワーアップ基盤
**As a** 開発者  
**I want** 拡張可能なパワーアップシステム  
**So that** 新しいパワーアップを簡単に追加できる

**受け入れ基準:**
- パワーアップ基底クラス
- プラグイン形式での追加
- 効果の重ね掛け管理
- 持続時間管理
- ビジュアルインジケーター

#### Story 4.2: 基本パワーアップ実装
**As a** プレイヤー  
**I want** 様々なパワーアップ  
**So that** 戦略的なプレイができる

**受け入れ基準（MVP）:**
- マルチボール（3個同時）
- パドルサイズ変更（大/小）
- ボール速度変更（速/遅）

**将来的な追加（v2.0）:**
- 貫通ボール
- マグネットパドル

### Epic 5: ビジュアルとオーディオ
**目的**: モダンレトロな視覚効果と音響効果

#### Story 5.1: テーマシステム
**As a** プレイヤー  
**I want** 複数のビジュアルテーマ  
**So that** 好みの見た目でプレイできる

**受け入れ基準:**
- ネオンテーマ
- ピクセルテーマ
- シンセウェーブテーマ
- ミニマルテーマ
- リアルタイム切り替え

#### Story 5.2: パーティクルエフェクト
**As a** プレイヤー  
**I want** 満足感のある視覚効果  
**So that** アクションが楽しく感じる

**受け入れ基準:**
- ブロック破壊パーティクル
- トレイルエフェクト
- 衝突スパーク
- パワーアップ獲得エフェクト
- 背景アニメーション

#### Story 5.3: サウンドシステム
**As a** プレイヤー  
**I want** 効果音とBGM  
**So that** 没入感が高まる

**受け入れ基準:**
- Web Audio API使用
- 衝突音
- ブロック破壊音
- BGMループ
- 音量調整機能

### Epic 6: レベルエディター
**目的**: ユーザー生成コンテンツのサポート

#### Story 6.1: エディターUI
**As a** プレイヤー  
**I want** 直感的なレベルエディター  
**So that** オリジナルレベルを作成できる

**受け入れ基準:**
- ドラッグ&ドロップインターフェース
- ブロックパレット
- グリッドスナップ
- プレビュー機能
- 元に戻す/やり直し

#### Story 6.2: レベル保存/共有
**As a** プレイヤー  
**I want** 作成したレベルを保存・共有できる  
**So that** 他のプレイヤーと楽しめる

**受け入れ基準:**
- JSON形式でのエクスポート
- レベルコードの生成
- インポート機能
- ローカルストレージ保存
- 検証機能

### Epic 7: 品質保証とテスト
**目的**: 高品質で信頼性の高いゲーム

#### Story 7.1: ユニットテスト
**As a** 開発者  
**I want** 包括的なユニットテスト  
**So that** バグを早期発見できる

**受け入れ基準:**
- Vitestセットアップ
- ゲームロジックのテスト
- 物理演算のテスト
- 状態管理のテスト
- 90%以上のカバレッジ

#### Story 7.2: E2Eテスト
**As a** 開発者  
**I want** エンドツーエンドテスト  
**So that** ユーザー体験を検証できる

**受け入れ基準:**
- Playwrightセットアップ
- 主要ユーザーフローのテスト
- クロスブラウザテスト
- レスポンシブテスト
- パフォーマンステスト

## 5. 技術仕様

### 5.1 アーキテクチャ概要
```
src/
├── components/        # Reactコンポーネント
│   ├── Game/         # ゲーム関連
│   ├── UI/           # UIコンポーネント
│   └── Editor/       # レベルエディター
├── game/             # ゲームエンジン
│   ├── core/         # コアシステム
│   ├── entities/     # ゲームエンティティ
│   ├── physics/      # 物理演算
│   └── rendering/    # レンダリング
├── hooks/            # カスタムフック
├── stores/           # Zustand stores
├── utils/            # ユーティリティ
└── types/            # TypeScript型定義
```

### 5.2 主要技術スタック
- **フロントエンド**: React 18, TypeScript 5
- **状態管理**: Zustand
- **スタイリング**: CSS Modules / Tailwind CSS
- **ビルドツール**: Vite
- **テスト**: Vitest, React Testing Library, Playwright
- **レンダリング**: Canvas API, WebGL (オプション)
- **オーディオ**: Web Audio API

## 6. マイルストーン

### Phase 1: 基盤構築（週1）
- プロジェクトセットアップ
- ゲームループ実装
- 基本的な物理演算
- シンプルなUI

### Phase 2: コアゲームプレイ（週2）
- 完全なゲームメカニクス
- パワーアップシステム
- レベル進行
- スコアシステム

### Phase 3: ポリッシュと拡張（週3）
- ビジュアルエフェクト
- サウンド実装
- レベルエディター
- テストとバグ修正

## 7. リスクと軽減策

| リスク | 影響 | 確率 | 軽減策 |
|--------|------|------|--------|
| パフォーマンス問題 | 高 | 中 | 早期プロファイリング、最適化 |
| ブラウザ互換性 | 中 | 低 | Polyfill使用、段階的機能実装 |
| スコープクリープ | 高 | 高 | MVP厳守、プラグイン化 |
| モバイル操作性 | 中 | 中 | 早期テスト、専用UI |

## 8. 成功指標とKPI

- **技術的KPI**
  - FPS: 60 維持率 > 95%
  - ロード時間: < 3秒
  - テストカバレッジ: > 90%
  
- **ユーザー体験KPI**
  - 平均セッション時間: > 5分
  - リテンション率: > 30%（7日）
  - 完走率: > 20%（10レベル）

- **開発効率KPI**
  - 新機能追加時間: < 2時間
  - バグ修正時間: < 30分
  - ビルド時間: < 30秒

## 9. 今後の拡張計画

### 将来的な機能
- マルチプレイヤーモード
- プロシージャル生成レベル
- アチーブメントシステム
- グローバルリーダーボード
- モバイルアプリ版
- WebGLレンダリング移行

## 10. 付録

### A. 用語集
- **HUD**: Heads-Up Display（ゲーム情報表示）
- **FPS**: Frames Per Second（秒間フレーム数）
- **AABB**: Axis-Aligned Bounding Box（軸並行境界ボックス）
- **HMR**: Hot Module Replacement（ホットモジュールリプレースメント）

### B. 参考資料
- [MDN Canvas API](https://developer.mozilla.org/docs/Web/API/Canvas_API)
- [React公式ドキュメント](https://react.dev)
- [Game Programming Patterns](https://gameprogrammingpatterns.com)